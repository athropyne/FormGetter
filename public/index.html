<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Документация</title>
<style>
    body{
        width:900px;
    }
    #content{
        background: #999922;
        font-size: 24px;
        padding: 10px;
    }
</style>
</head>
<body>
<div id="content">
    <h1>Документация</h1>
    <h2>Зачем?</h2>
    <p>
        Согласно <a
            href="https://docs.google.com/document/d/1fMFwPBs53xzcrltEFOpEG4GWTaQ-5jvVLrNT6_hmC7I/edit">задаче</a>
        есть основная точка API, принимающая данные в виде POST запроса в HTTP формате
        (<i>f_name1=value1&f_name2=value2</i>).
        API в ответ отдает имя шаблона формы, совпадающее по имени поля и значению типа данных. Присланный запрос может
        содержать больше полей не совпадающих с шаблоном, но имеющий в своем составе все поля из шаблона с
        соответствующими
        типами. Запрос не совпадающий ни с одним шаблоном возвращает сгенерированную форму состоящую из полей и типов
        данных.
    </p>
    <h2>Как запустить программу?</h2>
    <p>
    <ul>
        <li>На локальной машине должен быть установлен python (v3.10), дополнительное ПО не требуется</li>
        <li>Зависимости проекта: <br>
            <ul>
                <li>tinydb~=4.7.0</li>
                <li>python-dotenv~=0.21.0</li>
                <li>requests~=2.28.1</li>
                <li>fastapi~=0.88.0</li>
                <li>uvicorn~=0.20.0</li>
                <li>python-multipart~=0.0.5</li>
            </ul>
            <i>(при ошибках установки зависимостей автоматически - установите их вручную)</i>
        </li>
        <li>Отредактируйте файл .env в корне проекта - впишите свой хост и порт <i>(по умолчанию 127.0.0.1:8001)</i>
        </li>
        <li>Инициализируйте базу данных тестовыми значениями, пройдя по ссылке
            <a href="/test/FillDatabase">/test/FillDatabase</a></li>
        <li>Для очистки всей базы данных пройдите по ссылке <a href="/test/ClearDatabase">/test/ClearDatabase</a></li>
    </ul>
    </p>
    <h2>Как протестировать?</h2>
    <p>Для тестирования запустите модуль <b>fake_client.py</b> в корневой папке проекта.
        Результаты теста будут отображены в консоли.</p>
    <h2>Как кастомизировать тест?</h2>
    <p>
    <ul>
        <li>Добавьте новые данные для тестирования в пространство имен tests.data.FakeData в виде словарей.</li>
        <li>Очистите базу данных открыв путь /test/ClearDatabase или удалите файл <b>"db.json"</b> в корне проекта</li>
        <li>Инициализируйте базу данных новыми значениями открыв путь <a
                href="/test/FillDatabase">/test/FillDatabase</a></li>
        </li>
        <li>Проведите тестирование запустив модуль <b>fake_client.py</b></li>
    </ul>
    </p>
    <h2>Примечания</h2>
    <p>Вся основная логика работы программы находится в файле <b>main</b> в методе <b>get_form</b>.
        Не стал его декомпозировать, потому что так его будет проще прочитать и он полностью документирован. <br>
        За валидацию отвечает модуль utils.validator.py .
        Параметр запроса <b>MULTI_PATTERN</b> предназначена для спорных ситуаций,
        когда на вход приходят поля, в точности содержащие как поля одного шаблона, так и другого. Во включенном
        состоянии отдает список всех подходящих шаблонов, в выключенном - тот который больше похож или генерирует
        шаблон на лету в случае конфликтных ситуаций <i>(например если есть 2 шаблона с двумя полями в каждом,
         а запрос приходит с 4 полями и каждый из шаблонов подходит под него).</i> В тестовом клиенте (fake_client.py)
        берет этот параметр из <b>core.config.MULTI_PATTERN</b>
    </p>
    <p>Около 10-12 (!) часов ушло на то, чтобы попытаться придумать условие, по которому можно дернуть из бд нужное
        имя шаблона одним запросом. Не так у меня много опыта в NoSQL и скорее всего есть более элегантный способ
        получить нужные данные. Возможно очень жесткая рекурсивная генерация огромного условия в запросе решила бы
        задачу, но относительно tinydb я ничего не смог придумать больше чем выдернуть генератор всех документов
        и реализовать логику уже в коде. наверное с удаленной бд с гигабайтами данных это приведет к катастрофе,
        извините :)
    </p>
    <h2>P.S. </h2>
    <p>На выполнение задания ушло 2 дня с учетом построения алгоритмов, чтение документаций и написанием сих
    прекрасных слов. Спасибо :)</p>

</div>
</body>
</html>
